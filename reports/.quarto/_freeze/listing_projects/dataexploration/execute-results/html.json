{
  "hash": "b6ba94e4814132f95e592da3895197f3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Data exploration\"\nsubtitle: \"Exploratory analysis on the iris data set\"\nimage: /dataexpl.png\ndate: \"2024-05-18\"\n---\n\n\nData exploration is a big part of a Data Science project. It is the beginning of a project, where we try to understand our data and get an idea of the analysis we want to do to answer a specific question.\n\nA real-life problem usually doesn't come as in exercises \"construct a linear model with $y$ as the response and $x_{1}$ and $x_{2}$ as the covariates\". We need to apply the model we believe is the best both for our problem and the data we have.\n\nThis makes exploratory analysis an essential part of modelling. However, many people tend to not pay much attention on it. In this project we aim to showcase a complete data exploration and the fitting of a model based on it. We will work with the well known iris data set which is available in R.\n\nFirstly, let's import the libraries we will need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\n```\n:::\n\n\nWe will now import the iris data set which is available in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(iris)\nhead(iris, n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Sepal.Length Sepal.Width Petal.Length Petal.Width Species\n1          5.1         3.5          1.4         0.2  setosa\n2          4.9         3.0          1.4         0.2  setosa\n3          4.7         3.2          1.3         0.2  setosa\n4          4.6         3.1          1.5         0.2  setosa\n5          5.0         3.6          1.4         0.2  setosa\n```\n\n\n:::\n:::\n\n\n**Note:** Even though is the previous projects we have worked with tibbles, the iris data set is in a data frame. Tibbles are convenient to work with when you have large data and you use the readr::read_csv command. However, they are not suitable for mathematical operations, which is why we will use a data frame in our example where we want to fit a model.\n\nBefore we do any exploratory analysis we should be aware of the problem we are trying to solve. This is because there are countless exploratory analyses you can implement but this is not the point. We only need the information that is relevant to our question. This is even more important if we are working with large data sets, which is the case in many application.\n\nThe problem we will try to solve is whether we can predict sepal length of a flower from its sepal width and/or petal length and/or petal width. Also, does the suggested model change for the species of each flower?\n\nNow we know the question we will try to answer, let's get a summary of our data set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(iris)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   \n Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  \n 1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  \n Median :5.800   Median :3.000   Median :4.350   Median :1.300  \n Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  \n 3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  \n Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  \n       Species  \n setosa    :50  \n versicolor:50  \n virginica :50  \n                \n                \n                \n```\n\n\n:::\n:::\n\n\nThe above output tells us a lot. Firstly, it says that we have equal number of each species of flowers. This is really important because this implies that there is no bias towards any species.\n\nIt also shows some statistical values about the data. For example, for the means of the variables we have:\n\n| Variable     | Mean  |\n|--------------|-------|\n| Sepal Length | 5.843 |\n| Sepal Width  | 3.057 |\n| Petal Length | 3.758 |\n| Petal Width  | 1.199 |\n\nWe see that the variables' means are completely different and any comparison should take that into account. We will see the other elements of the summary in the below boxplot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(iris[,1:4], main=\"Boxplot for each variable\")\n```\n\n::: {.cell-output-display}\n![](dataexploration_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nWe notice again, the difference in the sizes of each variable and also that we don't have many outliers in the data, only some in sepal width.\n\nEven tho we can get an idea about the range of the observations for each variable from the boxplot, we will also present the standard deviations of the variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(sd(iris$Sepal.Length))\nprint(sd(iris$Sepal.Width))\nprint(sd(iris$Petal.Length))\nprint(sd(iris$Petal.Width))\n```\n:::\n\n\n| Variable     | Standard Deviation |\n|--------------|--------------------|\n| Sepal Length | 0.8280661          |\n| Sepal Width  | 0.4358663          |\n| Petal Length | 1.765298           |\n| Petal Width  | 0.7622377          |\n\nAbove we see that the range of the observations we get for each variable differ a lot.\n\nSince we will compare the impact of each predictor between the different species (setosa, versicolor, virginica) it will be useful to see if there is a difference in the statistical measures of the variables for each species. We see this in the boxplots below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,3),mar=c(6,3,2,1)) #to plot all boxplots in the same line\n\nboxplot(iris[1:4][iris$Species==\"setosa\",], main=\"Setosa\", ylim=c(0,8), las=2)\nboxplot(iris[1:4][iris$Species==\"versicolor\",], main=\"Versicolor\", ylim=c(0,8), las=2)\nboxplot(iris[1:4][iris$Species==\"virginica\",], main=\"Virginica\", ylim=c(0,8), las=2)\n```\n\n::: {.cell-output-display}\n![](dataexploration_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nAbove we see there are differences in all the statistical values for each variable per species and particularly in the medians and the ranges.\n\nSince we want to predict the sepal length, let's see how the sepal length is distributed with the following histogram.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(iris$Sepal.Length, main=\"Histogram of Sepal Length\", xlab=\"Sepal length\")\n```\n\n::: {.cell-output-display}\n![](dataexploration_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nHowever, we saw above that the sepal length has differences based on the species of flowers we are studying. So we would like to see how those differences are reflected in the distribution of sepal length. For this reason we will produce the histograms for each species.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,3))\nhist(iris$Sepal.Length[iris$Species==\"setosa\"], main=\"Setosa\", xlab=\"Sepal length\")\nhist(iris$Sepal.Length[iris$Species==\"versicolor\"], main=\"Versicolor\", xlab=\"Sepal length\")\nhist(iris$Sepal.Length[iris$Species==\"virginica\"],main=\"Virginica\", xlab=\"Sepal length\")\n```\n\n::: {.cell-output-display}\n![](dataexploration_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nIndeed there are differences in the way sepal length is distributed for every species, for example there are more flowers with large sepal length in the versicolor species than in the setosa and virginica. So this is an indication that we will need three models, each for every species, or better a model with covariates the ones already discussed and additionally $\\mathbb{1}_{set}$ and $\\mathbb{1}_{ver}$ and for setosa and versicolor respectively, while when they are both $0$ we have virginica.\n\nA good measure of linear relationship between variables is the Pearson correlation. Let's calculate the Pearson correlation of sepal length with sepal width, petal length and petal width.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(cor(iris$Sepal.Length, iris$Sepal.Width))\nprint(cor(iris$Sepal.Length, iris$Petal.Length))\nprint(cor(iris$Sepal.Length, iris$Petal.Width))\n```\n:::\n\n\n|              | Sepal Width | Petal Length | Petal Width |\n|--------------|-------------|--------------|-------------|\n| Sepal Length | -0.1175698  | 0.8717538    | 0.8179411   |\n\nWe see above that sepal length has a high linear correlation with petal length and petal width, so the latter seem to be useful predictors for the former. The relationship in both cases is positive. However, when it comes to sepal width we see that it is not highly linearly correlated with sepal length. Many would be quick to say that this means that sepal width is not a good predictor. However, let's see how the correlation changes with flower species.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(cor(iris$Sepal.Length[iris$Species==\"setosa\"], iris$Sepal.Width[iris$Species==\"setosa\"]))\nprint(cor(iris$Sepal.Length[iris$Species==\"versicolor\"], iris$Sepal.Width[iris$Species==\"versicolor\"]))\nprint(cor(iris$Sepal.Length[iris$Species==\"virginica\"], iris$Sepal.Width[iris$Species==\"virginica\"]))\n```\n:::\n\n\n| Sepal length/Sepal width | Setosa    | Versicolor | Virginica |\n|--------------------------|-----------|------------|-----------|\n| Sepal length             | 0.7425467 | 0.5259107  | 0.4572278 |\n\nIn this case we see that for the setosa species the correlation between sepal length and sepal width is large. This means that sepal width can be an important predictor for sepal length and should be included in the model. Of course we are gonna confirm this later, but the exploratory analysis so far has given us an idea of the relationship between the variables.\n\nTo make this relation even easier to understand we will plot pairplots for the data. Also, we will colour each species differently to see how the relationship changes with the species in each case. \n\n::: {.cell}\n\n```{.r .cell-code}\npairs(iris[,1:4],col=iris[,5],oma=c(6,6,6,12))\npar(xpd=TRUE) #for the colouring\nlegend(0.85, 0.6,as.vector(unique(iris$Species)),fill=c(1,2,3))\n```\n\n::: {.cell-output-display}\n![](dataexploration_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\nIn the above plot we see the relationships more clearly. All predictors seem to be significant to predict sepal length and they all have a linear relationship with it, some stronger (petal length and width) and some weaker (sepal width for versicolor and virginica). As we can see, the relationships for each species are different so we want to model it differently. This is why we have reached the full model:\n\\begin{equation}\nY=\\alpha+\\beta_{1}X_{1}+\\beta_{2}X_{2}+\\beta_{3}X_{3}+\\gamma_{1}\\mathbb{1}_{set}+\\gamma_{2}\\mathbb{1}_{ver},\n\\end{equation}\nwhere $Y=$Sepal Length, $X_{1}=$Sepal Width, $X_{2}=$Petal Length and $X_{3}=$Petal Width. Also $\\mathbb{1}_{set}=1$ for setosa and $\\mathbb{1}_{ver}=1$ for versicolor. When they are both $0$ we have virginica.\n\nTo fit the model above we firstly need to add to our data frame the variables $\\mathbb{1}_{set}, \\mathbb{1}_{ver}$ and $\\mathbb{1}_{vir}$ that become one only for setosa, versicolor and virginica respectively. We do this below.\n\n::: {.cell}\n\n```{.r .cell-code}\n#we create variables Setosa, Versicolor\niris$Setosa=rep(0, 150)\niris$Versicolor=rep(0, 150)\n\n#we put 1 where variables become setosa and versicolor respectively\niris$Setosa[which(iris$Species==\"setosa\")]=1\niris$Versicolor[which(iris$Species==\"versicolor\")]=1\nhead(iris, n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Sepal.Length Sepal.Width Petal.Length Petal.Width Species Setosa Versicolor\n1          5.1         3.5          1.4         0.2  setosa      1          0\n2          4.9         3.0          1.4         0.2  setosa      1          0\n3          4.7         3.2          1.3         0.2  setosa      1          0\n4          4.6         3.1          1.5         0.2  setosa      1          0\n5          5.0         3.6          1.4         0.2  setosa      1          0\n```\n\n\n:::\n:::\n\n\nNow we have everything we need to build our model. We fit it below and get its summary.\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel<-lm(Sepal.Length~Sepal.Width+Petal.Length+Petal.Width+Setosa+Versicolor, data=iris)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width + \n    Setosa + Versicolor, data = iris)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.79424 -0.21874  0.00899  0.20255  0.73103 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   1.14777    0.35356   3.246  0.00145 ** \nSepal.Width   0.49589    0.08607   5.761 4.87e-08 ***\nPetal.Length  0.82924    0.06853  12.101  < 2e-16 ***\nPetal.Width  -0.31516    0.15120  -2.084  0.03889 *  \nSetosa        1.02350    0.33373   3.067  0.00258 ** \nVersicolor    0.29994    0.11898   2.521  0.01280 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3068 on 144 degrees of freedom\nMultiple R-squared:  0.8673,\tAdjusted R-squared:  0.8627 \nF-statistic: 188.3 on 5 and 144 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\nIn the model above we see that all predictors have p-value less than $0.05$ which indicates they are statistically significant as the exploratory analysis had implied. Also, the adjusted $R^{2}$ is $86.27$ which shows the model is a good fit for the data. The fitted model is \n\\begin{equation}\nY=1.418+0.496X_{1}+0.829X_{2}-0.315X_{3}+1.024\\mathbb{1}_{set}+0.3\\mathbb{1}_{ver}.\n\\end{equation}\nWith the model above we can predict the sepal length from the other variables and answer to any relevant questions about it.\n\nHere our project ends. The main purpose of the project was to show how an exploratory analysis should be designed and implemented. Of course, there are a lot you can do to explore the data, but we tried to do only what is relevant to the question we had to ask. We then saw how this exploratory analysis helped us to design the appropriate model for our problem.\n\nI hope you enjoyed the project and got an idea of what exploratory analysis should include. Good luck to your projects!",
    "supporting": [
      "dataexploration_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}