{
  "hash": "f25dbd82b09717c5de47417749ac8c80",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"The Economist plots\"\nsubtitle: \"Plotting data using the Economist guidelines\"\nimage: /economistlogo.png\ndate: \"2024-02-21\"\n---\n\n\nIn this project we designed plots for an article published in a scientific magazine. The aim of the article is to present the results of the [Survey and Diary of Consumer Choice](https://www.atlantafed.org/banking-and-payments/consumer-payments/survey-and-diary-of-consumer-payment-choice) related to the payment choices of Americans.\n\nOf course the above survey is very large, but we will focus on the data that would be of interest for the readers of the magazine, who have general knowledge in Finance. Specifically, we will plot the percentage of payments for each payment method, the amount of money in \\$ spent with each payment method and the percentage of payments using online payment methods for younger people (Gen Y and Z) and for older generations.\n\nAll the above will be plotted according to \"The Economist\" style guide, which can be found [here](https://design-system.economist.com/documents/CHARTstyleguide_20170505.pdf).\n\nTo begin with, let's import the libraries we will use for our data wrangling and plots.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(warn=-1) #to mute any warnings and make our presentation easier for the reader\n\nlibrary(dplyr)\nlibrary(grid)\nlibrary(tidyverse)\nlibrary(gridExtra)\nlibrary(ggplot2)\nlibrary(cowplot)\n```\n:::\n\n\nLet's start by importing the data. You can download the required data [here](https://www.atlantafed.org/banking-and-payments/consumer-payments/survey-and-diary-of-consumer-payment-choice/2022-survey-and-diary#Tab3).\n\n**Note:** You need to download the data for the individual level data and transactions level data, and have them in your working directory to run the codes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(warn=-1)\n\nindividual_level_data<-readr::read_csv(file=\"dcpc_2022_indlevel_public_xls.csv\")\ntransaction_level_data<-readr::read_csv(file=\"dcpc_2022_tranlevel_public_xls.csv\")\n```\n:::\n\n\nWe only want to use some columns from these data. From the individual level dataset we want to use the columns related to age, whether the individual has adopted one of the following non-bank online payment (NBOP) methods: Paypal, Zelle, Venmo, other methods and whether the individual has an NBPO account. We clean the dataset by choosing these columns below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindividual_level_data_cleaned<-individual_level_data %>% select(age, paypal_adopt, zelle_adopt, venmo_adopt, other_nbops_adopt, nbop_acnt_adopt)\nhead(individual_level_data_cleaned, n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 6\n    age paypal_adopt zelle_adopt venmo_adopt other_nbops_adopt nbop_acnt_adopt\n  <dbl>        <dbl>       <dbl>       <dbl>             <dbl>           <dbl>\n1    39            1           0           1                 0               1\n2    73            0           0           0                 0               0\n3    61            1           0           0                 0               1\n4    64            0           0           0                 0               0\n5    63            1           0           1                 0               1\n```\n\n\n:::\n:::\n\n\nWe see that we have all the information we wanted.\n\nWhen it comes to the transaction level dataset we want the information about the payment instrument used, the amount of money transferred with this instrument, if the transaction was a payment and the type of merchant the transaction included. We do this below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntransaction_level_data_cleaned<-transaction_level_data %>% select(pi, amnt, payment, merch)\nhead(transaction_level_data_cleaned, n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 4\n     pi  amnt payment merch\n  <dbl> <dbl>   <dbl> <dbl>\n1     3  102.       1    12\n2     1  600        1    14\n3     1   10        1    16\n4     4   70        1     1\n5     1   80        1     2\n```\n\n\n:::\n:::\n\n\nAgain, we have included all the required information above. Now we have smaller datasets we will proceed to the plotting. Note that the number in the payment instruments (pi) variable refer to types of payment instruments. To see what each one means see [data codebook](https://www.atlantafed.org/-/media/documents/banking/consumer-payments/survey-diary-consumer-payment-choice/2022/dcpc2022_codebook.pdf). The same goes to the merchant (merch) variable.\n\nWe firstly create the barplot of the number of payments per payment options. This will be a simple barplot without titles or subtitles. We will add everything we need later.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(warn=-1)\n\nBLUE <- \"#076fa2\"\nRED <- \"#E3120B\"\nBLACK <- \"#202020\"\nGREY <- \"grey50\"\n\n#create function for the initial barplot\nmake_number_of_each_method_barplot=function(tib){\n  tib_grouped_by_method=tib %>% \n    group_by(pi) %>%\n    summarise(number=length(pi))\n  tib_grouped_by_method=tib_grouped_by_method[-14, ]\n  \n\n  \n  # Basic barplot\n  \n  name=c(\"Multiple payment methods\", \"Cash\", \"Checks\", \"Credit card\", \"Debit card\", \"Prepaid/gift/EBT card\", \"Bank account\", \"Online banking\", \"Money order\", \"Paypal\", \"Account-to-account\", \"Other method\", \"Deduction from income\")\n  value=tib_grouped_by_method$number\n  plt<-ggplot(tib_grouped_by_method)+\n    geom_col(aes(value,name),fill=BLUE, width=0.6)\n  \n  \n  \n  # Determining the grid, removing the ticks, adding labels etc.\n  \n  plt<-plt+\n    scale_x_continuous(\n      limits = c(0, 6500),\n      breaks = seq(0, 6500, by = 1000), \n      expand = c(0, 0), \n      position = \"top\" \n    ) +\n    scale_y_discrete(expand = expansion(add = c(0, 0.5))) +\n    theme(\n      \n      panel.background = element_rect(fill = \"white\"), # white background\n      \n      panel.grid.major.x = element_line(color = \"#A8BAC4\", linewidth= 0.3),\n      \n      axis.ticks.length = unit(0, \"mm\"),\n      \n      axis.title = element_blank(),\n      \n      axis.line.y.left = element_line(color = \"black\"),\n      \n      axis.text.x = element_text(family = \"Econ Sans cnd\", size = 15, colour=\"black\"), # x axis labels\n      \n      axis.text.y = element_text(family = \"Econ Sans cnd\", size = 15, colour=\"black\") # y axis labels\n    )\n\n  \n\n  plt <- plt + \n    labs(title = NULL, subtitle = NULL) +\n    theme(\n      plot.margin = margin(0.15, 0, 0.1, 0.01, \"npc\")\n    )\n  \n  plt\n}\n\nmake_number_of_each_method_barplot(transaction_level_data_cleaned)\n```\n\n::: {.cell-output-display}\n![](theeconomist_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nThe above bar plot follows the style guide of the economist only in what it has to do with the size of the letters, the colour of the bars and the background and the absence of grid. We, of course need to add a title, subtitle, the source of the data in the bottom and the iconic \"The Economist\" red line on top. We do all these below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(warn=-1)\n\n#the plot\nmake_number_of_each_method_barplot(transaction_level_data_cleaned)\n\n#add annotations\n\ngrid.text(\n  \"Payment choices\", \n  0, \n  0.925,\n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    fontsize = 22,\n    fontface = \"bold\",\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n\ngrid.text(\n  \"Number of transactions per payment instrument\", \n  0, \n  0.875,\n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    fontsize = 20,\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n\ngrid.lines(\n  x = c(0, 1),\n  y = 1,\n  gp = gpar(col = \"#e5001c\", lwd = 4)\n)\n\ngrid.rect(\n  x = 0,\n  y = 1,\n  width = 0.05,\n  height = 0.025,\n  just = c(\"left\", \"top\"),\n  gp = gpar(fill = \"#e5001c\", lwd = 0)\n)\n\ngrid.text(\n  \"Sources: Survey and Diary of Consumer Payment Choice, Federal Reserve Bank of Atlanta\", \n  x = 0.005, \n  y = 0.06, \n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    col = \"grey50\",\n    fontsize = 16,\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n```\n\n::: {.cell-output-display}\n![](theeconomist_files/figure-html/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\nSimple, isn't it? Now we move to the barplot with the number of payments per payment method. We want to see if for example some instruments are chosen for more payments but for less money than others. We proceed as above, firstly creating the basic plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(warn=-1)\n\nmake_money_for_each_method_barplot=function(tib){\n  \n  tib_grouped_by_method=tib %>% \n                   group_by(pi) %>%\n                   summarise(amount=sum(amnt,na.rm=TRUE))\n  tib_grouped_by_method=tib_grouped_by_method[-14,]\n  \n  BLUE <- \"#076fa2\"\n  RED <- \"#E3120B\"\n  BLACK <- \"#202020\"\n  GREY <- \"grey50\"\n  \n  name=c(\"Multiple payment methods\", \"Cash\", \"Checks\", \"Credit card\", \"Debit card\", \"Prepaid/gift/EBT card\", \"Bank account\", \"Online banking\", \"Money order\", \"Paypal\", \"Account-to-account\", \"Other method\", \"Deduction from income\")\n  value=tib_grouped_by_method$amount\n  \n  # Basic barplot\n  plt <- ggplot(tib_grouped_by_method) +\n    geom_col(aes(value, name), fill = BLUE, width = 0.6) \n  \n  # Determining the grid, removing the ticks, adding labels etc.\n  plt <- plt + \n    scale_x_continuous(\n      limits = c(\"0\"=0, \"750k\"=750000),\n      breaks = c(\"0\"=0,\"100k\"=100000,\"200k\"=200000,\"300k\"=300000,\"400k\"=400000,\"500k\"=500000,\"600k\"=600000,\"700k\"=700000), \n      expand = c(0, 0), # The horizontal axis does not extend to either side\n      position = \"top\"  # Labels are located on the top\n    ) +\n    \n    scale_y_discrete(expand = expansion(add = c(0, 0.5))) +\n    theme(\n      \n      panel.background = element_rect(fill = \"white\"), #white background\n      \n      panel.grid.major.x = element_line(color = \"#A8BAC4\", size = 0.3),\n      \n      axis.ticks.length = unit(0, \"mm\"),\n      \n      axis.title = element_blank(),\n      \n      axis.line.y.left = element_line(color = \"black\"),\n      \n      axis.text.y = element_text(family=\"Econ Sans Cnd\", size=16, colour=\"black\"), # y axis labels\n      \n      axis.text.x = element_text(family = \"Econ Sans Cnd\", size = 16, colour=\"black\") # x axis labels\n    )\n  plt <- plt + \n    theme(\n      plot.margin = margin(0.15, 0, 0.1, 0.01, \"npc\")\n    )\n  \n  \n  plt\n  \n}\n\nmake_money_for_each_method_barplot(transaction_level_data_cleaned)\n```\n\n::: {.cell-output-display}\n![](theeconomist_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nAnd then adding the annotations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(warn=-1) #to silent options and make the presentation better\n\n#plot\nmake_money_for_each_method_barplot(transaction_level_data_cleaned)\n\n#adding annotations\ngrid.text(\n  \"Payment choices revisited\", \n  0, \n  0.925,\n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    fontsize = 22,\n    fontface = \"bold\",\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n\ngrid.text(\n  \"Total amount of money in $ included in transactions per method\", \n  0, \n  0.875,\n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    fontsize = 20,\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n\ngrid.lines(\n  x = c(0, 1),\n  y = 1,\n  gp = gpar(col = \"#e5001c\", lwd = 4)\n)\n\ngrid.rect(\n  x = 0,\n  y = 1,\n  width = 0.05,\n  height = 0.025,\n  just = c(\"left\", \"top\"),\n  gp = gpar(fill = \"#e5001c\", lwd = 0)\n)\n\ngrid.text(\n  \"Sources: Survey and Diary of Consumer Payment Choice, Federal Reserve Bank of Atlanta\", \n  x = 0.005, \n  y = 0.06, \n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    col = \"grey50\",\n    fontsize = 16,\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n```\n\n::: {.cell-output-display}\n![](theeconomist_files/figure-html/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\nThe final barplot we will show is the barplot that shows the difference in the percentage of people who use online payment methods between generations Z and Y and older generations. The reason for this plot is that in the article we discussed above the author wants to see if modern payment methods are more popular among young people or not.\n\nBefore we make this plot we will add a new column to our individual level dataset. Specifically, we will add a new variable that takes 1 for gens Y and Z and 0 for older generations. This will help us distinguish between these two groups.\n\n**Note:** There are various definitions of the generations, however, we will take the one used in the article which is: gen Y and Z are between 18 and 38 years old and older gens are older than 38 years old.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(warn=-1)\n\ncreate_gen_dataset=function(tib){ \n  n=length(tib$age)\n  tib$age_group<-rep(0,n)\n  for (i in 1:n){\n    if (tib$age[i]>=18 & tib$age[i]<=38){\n      tib$age_group[i]=1\n    }\n    \n  }\n  return(tib)\n  \n}\n\nindividual_level_data_age_group_cleaned=create_gen_dataset(individual_level_data_cleaned)\nhead(individual_level_data_age_group_cleaned, n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 7\n    age paypal_adopt zelle_adopt venmo_adopt other_nbops_adopt nbop_acnt_adopt\n  <dbl>        <dbl>       <dbl>       <dbl>             <dbl>           <dbl>\n1    39            1           0           1                 0               1\n2    73            0           0           0                 0               0\n3    61            1           0           0                 0               1\n4    64            0           0           0                 0               0\n5    63            1           0           1                 0               1\n# ℹ 1 more variable: age_group <dbl>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(warn=-1)\n\nmake_percentage_per_gen_barplot=function(tib){\n  tib<-tib %>% drop_na() # we drop everyone who hasn't given age or if they have adopted nbop\n  n=length(tib$age)\n  \n  \n  tib_grouped_by_age_group<-tib %>%\n    group_by(age_group) %>%\n     summarise(percentage=100*sum(nbop_acnt_adopt)/n)\n  \n  name<-c(\"Older Generations\",\"Gen Y and Z\")\n  value<-tib_grouped_by_age_group$percentage\n  \n  \n  plt <- ggplot(tib_grouped_by_age_group) +\n    geom_col(aes(name, value), fill = BLUE, width = 0.6) \n  \n  plt <- plt + \n    scale_y_continuous(\n      limits = c(0, 50),\n      breaks = seq(0, 50, by = 10), \n      expand = c(0, 0), \n      position = \"right\"  \n    ) +\n     \n    scale_x_discrete(expand = expansion(add = c(0, 0.5))) +\n    theme(\n      \n      panel.background = element_rect(fill = \"white\"), # white background\n      \n      panel.grid.major.y = element_line(color = \"#A8BAC4\", size = 0.3),\n      \n      axis.ticks.length = unit(0, \"mm\"),\n      \n      axis.title = element_blank(),\n      \n      axis.line.x.bottom = element_line(color = \"black\"),\n      \n      axis.text.y = element_text(family = \"Econ Sans Cnd\", size = 16, colour=\"black\"), # y axis labels\n      \n      axis.text.x = element_text(family = \"Econ Sans Cnd\", size = 16, colour=\"black\") # x axis labels\n    )\n  plt <- plt + \n    labs(title = NULL, subtitle = NULL) +\n    theme(\n      plot.margin = margin(0.15, 0, 0.1, 0.01, \"npc\")\n    )\n  plt\n}\n\nmake_percentage_per_gen_barplot(individual_level_data_age_group_cleaned)\n\ngrid.text(\n  \"Are young people more into non-bank online payments?\", \n  0, \n  0.925,\n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    fontsize = 22,\n    fontface = \"bold\",\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n\ngrid.text(\n  \"Percentage of people who have adopted a non-payment platform\", \n  0, \n  0.875,\n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    fontsize = 20,\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n\ngrid.lines(\n  x = c(0, 1),\n  y = 1,\n  gp = gpar(col = \"#e5001c\", lwd = 4)\n)\n\ngrid.rect(\n  x = 0,\n  y = 1,\n  width = 0.05,\n  height = 0.025,\n  just = c(\"left\", \"top\"),\n  gp = gpar(fill = \"#e5001c\", lwd = 0)\n)\n\ngrid.text(\n  \"Sources: Survey and Diary of Consumer Payment Choice, Federal Reserve Bank of Atlanta\", \n  x = 0.005, \n  y = 0.06, \n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    col = \"grey50\",\n    fontsize = 16,\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n```\n\n::: {.cell-output-display}\n![](theeconomist_files/figure-html/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\nWith he above plot the project ends. I hope it gave you an idea of some commands to use when you want to create more stylish plots. We only considered barplots in this project but you can easily generalise this code to other plots, just plot and then use the annotations like we demonstrated above. If you have any comments to make feel free to email me!\n",
    "supporting": [
      "theeconomist_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}